<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Venus集群组件介绍 | Venus Filecoin</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/assets/icon-coin-128.png">
    <meta name="description" content="Venus是完全兼容Filecoin分布式存储网络的一个go版本代码实现">
    
    <link rel="preload" href="/assets/css/0.styles.117964e0.css" as="style"><link rel="preload" href="/assets/js/app.f57c37a9.js" as="script"><link rel="preload" href="/assets/js/2.7ef722c3.js" as="script"><link rel="preload" href="/assets/js/12.cc8a9a44.js" as="script"><link rel="prefetch" href="/assets/js/10.1a7639a0.js"><link rel="prefetch" href="/assets/js/11.0229239f.js"><link rel="prefetch" href="/assets/js/13.4fc9e84b.js"><link rel="prefetch" href="/assets/js/14.7eff6aee.js"><link rel="prefetch" href="/assets/js/15.74f3a7bf.js"><link rel="prefetch" href="/assets/js/16.cdca08b2.js"><link rel="prefetch" href="/assets/js/17.63412707.js"><link rel="prefetch" href="/assets/js/18.f65562f4.js"><link rel="prefetch" href="/assets/js/19.e10d75bd.js"><link rel="prefetch" href="/assets/js/20.8cab8b82.js"><link rel="prefetch" href="/assets/js/21.89e7f6ef.js"><link rel="prefetch" href="/assets/js/22.946f1426.js"><link rel="prefetch" href="/assets/js/23.29956ea4.js"><link rel="prefetch" href="/assets/js/24.72434d5b.js"><link rel="prefetch" href="/assets/js/25.0357bdbf.js"><link rel="prefetch" href="/assets/js/26.564b8b15.js"><link rel="prefetch" href="/assets/js/27.c08ea520.js"><link rel="prefetch" href="/assets/js/28.cb57d890.js"><link rel="prefetch" href="/assets/js/29.4b695239.js"><link rel="prefetch" href="/assets/js/3.021311b3.js"><link rel="prefetch" href="/assets/js/30.d10e5819.js"><link rel="prefetch" href="/assets/js/31.5c0149d8.js"><link rel="prefetch" href="/assets/js/32.d884fd3c.js"><link rel="prefetch" href="/assets/js/33.84c3767f.js"><link rel="prefetch" href="/assets/js/34.6500b9bf.js"><link rel="prefetch" href="/assets/js/35.92ecc25b.js"><link rel="prefetch" href="/assets/js/36.0015a1e1.js"><link rel="prefetch" href="/assets/js/37.5116b46f.js"><link rel="prefetch" href="/assets/js/38.709eb876.js"><link rel="prefetch" href="/assets/js/39.b91ad236.js"><link rel="prefetch" href="/assets/js/4.a0cfb79d.js"><link rel="prefetch" href="/assets/js/40.317adfe4.js"><link rel="prefetch" href="/assets/js/41.485af4f7.js"><link rel="prefetch" href="/assets/js/42.9f6a15cd.js"><link rel="prefetch" href="/assets/js/43.730c234b.js"><link rel="prefetch" href="/assets/js/44.efb87045.js"><link rel="prefetch" href="/assets/js/45.0dc7aaf2.js"><link rel="prefetch" href="/assets/js/46.32ffda83.js"><link rel="prefetch" href="/assets/js/47.1f9a2e7f.js"><link rel="prefetch" href="/assets/js/48.b3055033.js"><link rel="prefetch" href="/assets/js/49.ed8710d4.js"><link rel="prefetch" href="/assets/js/5.a5f79296.js"><link rel="prefetch" href="/assets/js/50.fbb4370c.js"><link rel="prefetch" href="/assets/js/51.f23d7fe5.js"><link rel="prefetch" href="/assets/js/52.93e92312.js"><link rel="prefetch" href="/assets/js/53.1854043e.js"><link rel="prefetch" href="/assets/js/54.cc6ce045.js"><link rel="prefetch" href="/assets/js/55.95ac6324.js"><link rel="prefetch" href="/assets/js/56.583b7e32.js"><link rel="prefetch" href="/assets/js/57.31a148f9.js"><link rel="prefetch" href="/assets/js/58.87afd8a5.js"><link rel="prefetch" href="/assets/js/59.818ad65a.js"><link rel="prefetch" href="/assets/js/6.16916ee1.js"><link rel="prefetch" href="/assets/js/60.5e12e5b4.js"><link rel="prefetch" href="/assets/js/61.7671da8e.js"><link rel="prefetch" href="/assets/js/62.918abf77.js"><link rel="prefetch" href="/assets/js/63.880ae3b2.js"><link rel="prefetch" href="/assets/js/64.24f8213f.js"><link rel="prefetch" href="/assets/js/7.71df8875.js"><link rel="prefetch" href="/assets/js/8.3e303fe4.js"><link rel="prefetch" href="/assets/js/9.520caffd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.117964e0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><img src="/assets/filecoin-logo.svg" alt="Venus Filecoin" class="logo"> <span class="site-name can-hide">Venus Filecoin</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://docs.filecoin.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Filecoin文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/filecoin-project/venus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/How-To-Deploy-MingPool.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/How-To-Deploy-MingPool.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://docs.filecoin.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Filecoin文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/filecoin-project/venus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/How-To-Deploy-MingPool.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/How-To-Deploy-MingPool.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Filecoin Venus教程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/Home.html" class="sidebar-link">首页</a></li><li><a href="/zh/Overview.html" class="sidebar-link">概述</a></li><li><a href="/zh/How-To-Deploy-MingPool.html" aria-current="page" class="active sidebar-link">部署Venus组件集群</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#_1-venus-auth-install" class="sidebar-link">1. Venus-auth Install</a></li><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#_2-venus-install" class="sidebar-link">2. Venus install</a></li><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#_3-venus-wallet-install" class="sidebar-link">3. Venus-wallet install</a></li><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#_4-venus-messager-install" class="sidebar-link">4. Venus-messager install</a></li><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#_5-venus-sealer-install" class="sidebar-link">5. Venus-sealer install</a></li><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#_6-venus-miner-install" class="sidebar-link">6. Venus-miner install</a></li><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#_7-问题相关" class="sidebar-link">7. 问题相关</a></li></ul></li><li><a href="/zh/Venus-replace-lotus.html" class="sidebar-link">Venus替换Lotus</a></li><li><a href="/zh/venus_load_balancing.html" class="sidebar-link">Venus负载均衡</a></li><li><a href="/zh/Tips-Running-In-China.html" class="sidebar-link">中国部署小贴士</a></li><li><a href="/zh/How to use venus messager.html" class="sidebar-link">如何使用Venus messager组件</a></li><li><a href="/zh/Venus-Worker.html" class="sidebar-link">Venus Worker用法</a></li><li><a href="/zh/Venus wallet.html" class="sidebar-link">Venus wallet使用</a></li><li><a href="/zh/chain.html" class="sidebar-link">链管理</a></li><li><a href="/zh/How-To-Use-Wallet-In-Venus.html" class="sidebar-link">Venus程序中的钱包使用</a></li><li><a href="/zh/Multisig-Wallet.html" class="sidebar-link">Venus内嵌的多签使用</a></li><li><a href="/zh/Payment-Channel.html" class="sidebar-link">付款通道（paych）使用</a></li><li><a href="/zh/Commands.html" class="sidebar-link">CLI 命令</a></li><li><a href="/zh/Getting-Started.html" class="sidebar-link">快速启动</a></li><li><a href="/zh/How-To-Connect-Network.html" class="sidebar-link">连接节点网络</a></li><li><a href="/zh/How-To-Setup_2knet.html" class="sidebar-link">启动本地2K测试网</a></li><li><a href="/zh/Troubleshooting-&amp;-FAQ.html" class="sidebar-link">故障排除和常见问题解答</a></li><li><a href="/zh/How-To-Contribute-Docs.html" class="sidebar-link">如何部署文档</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resources</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="venus集群组件介绍"><a href="#venus集群组件介绍" class="header-anchor">#</a> Venus集群组件介绍</h1> <p>Venus是Filecoin分布式矿池的实现方案之一，系统集群组件包括：Venus，Venus-auth，Venus-miner，Venus-wallet，Venus-messager，Venus-sealer。从概念上理解其中Venus、Venus-auth、Venus-miner、Venus-wallet、Venus-messager具备可共用性（即程序可被多个矿工身份使用，在保证效率的情况下使硬件，软件资源得到充分利用），而Venus-sealer、Venus-worker、Venus-wallet主要用于积累算力。Venus-wallet属于可选组件，基于部署情况的安全性考量，Venus-wallet可以共享使用，也可以本地部署。本篇文档为nerpda测试网络下的集群部署。</p> <p><img src="/assets/img/venus-cluster.2e72d412.png" alt="venus-cluster"></p> <h1 id="venus集群部署-基于nerpa测试网"><a href="#venus集群部署-基于nerpa测试网" class="header-anchor">#</a> Venus集群部署（基于nerpa测试网）</h1> <table><thead><tr><th>程序</th> <th>服务器</th> <th>类型</th> <th>作用</th></tr></thead> <tbody><tr><td>Venus-auth</td> <td>&lt;IP1&gt;</td> <td>共享</td> <td>Venus-auth 用于统一授权，当矿工组件访问共享组件的时候需要使用此服务注册生成的token</td></tr> <tr><td>Venus-wallet</td> <td>&lt;IP2&gt;</td> <td>共享</td> <td>钱包管理，数据签名</td></tr> <tr><td>Venus</td> <td>&lt;IP3&gt;</td> <td>共享</td> <td>Filecoin节点数据同步</td></tr> <tr><td>Venus-messager</td> <td>&lt;IP4&gt;</td> <td>共享</td> <td>管理集群中的消息，保证消息上链，控制消息流量，重试等。可对接多个钱包，针对这些钱包做消息管理</td></tr> <tr><td>Venus-miner</td> <td>&lt;IP5&gt;</td> <td>共享</td> <td>打包出块消息，可配置多个矿工，会自行计算矿工出块情况，并通过远程访问Venus-sealer获取数据证明</td></tr> <tr><td>Venus-sealer</td> <td>&lt;IP6&gt;</td> <td>非共享</td> <td>数据封装</td></tr></tbody></table> <p>Tips:</p> <ul><li>以下所有<code>&lt;&gt;</code>都是需替换参数，根据自己的实际情况替换</li> <li>具体版本请自行使用git checkout选择</li> <li>环境依赖：
<ul><li>golang ^1.15
<ul><li>go env -w GOPROXY=https://goproxy.io,direct</li> <li>go env -w GO111MODULE=on</li></ul></li> <li>git</li></ul></li></ul> <h2 id="_1-venus-auth-install"><a href="#_1-venus-auth-install" class="header-anchor">#</a> 1. Venus-auth Install</h2> <h3 id="编译并启动"><a href="#编译并启动" class="header-anchor">#</a> 编译并启动</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> clone https://github.com/filecoin-project/venus-auth.git

$ <span class="token builtin class-name">cd</span> venus-auth

$ <span class="token function">make</span> 

$ <span class="token function">nohup</span> ./venus-auth <span class="token operator">&gt;</span> auth.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>

</code></pre></div><ul><li>Venus-auth服务默认配置文件目录为 ~/.venus-auth/config.toml</li> <li>存储方案默认为badger内嵌kv数据库，也支持MYSQL存储，需要自行修改配置文件后启动。</li> <li>log存储默为控制台打印，同时支持influxDB存储</li></ul> <h4 id="mysql存储启动-可选"><a href="#mysql存储启动-可选" class="header-anchor">#</a> MYSQL存储启动（可选）</h4> <p>Tips: MYSQL支持5.7以上官方版本（如云平台MYSQL默认设置各有不同，请自己结合云平台修改配置，否则可能会出现 “ Specified key was too long; max key length is 767 bytes ”）</p> <ul><li>初始化数据库及表</li></ul> <div class="language-mysql extra-class"><pre class="language-text"><code>CREATE DATABASE `venus_auth` /*!40100 DEFAULT CHARACTER SET utf8 */;
USE `venus_auth`;

CREATE TABLE `token` (
     `name` varchar(50) NOT NULL,
     `token` varchar(512) NOT NULL,
     `createTime` datetime NOT NULL,
     `perm` varchar(50) NOT NULL,
     `extra` varchar(255) DEFAULT NULL,
     UNIQUE KEY `token_token_IDX` (`token`) USING HASH
) ENGINE=InnoDB
  DEFAULT CHARSET = utf8
  COLLATE = utf8_general_ci;

</code></pre></div><ul><li>修改Venus-auth config中的db设置</li></ul> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">vim</span> ~/.venus-auth/config.toml

<span class="token comment"># 数据源配置项</span>
<span class="token punctuation">[</span>db<span class="token punctuation">]</span>
<span class="token comment"># support: badger (default), mysql </span>
<span class="token comment"># the mysql DDL is in the script package </span>
<span class="token builtin class-name">type</span> <span class="token operator">=</span> <span class="token string">&quot;mysql&quot;</span> 
<span class="token comment"># The following parameters apply to MySQL</span>
DSN <span class="token operator">=</span> <span class="token string">&quot;root:111111@(127.0.0.1:3306)/venus_auth?parseTime=true&amp;loc=Local&amp;charset=utf8mb4&amp;collation=utf8mb4_unicode_ci&amp;readTimeout=10s&amp;writeTimeout=10s&quot;</span>
<span class="token comment"># conns 1500 concurrent</span>
maxOpenConns <span class="token operator">=</span> <span class="token number">64</span>
maxIdleConns <span class="token operator">=</span> <span class="token number">128</span>
maxLifeTime <span class="token operator">=</span> <span class="token string">&quot;120s&quot;</span>
maxIdleTime <span class="token operator">=</span> <span class="token string">&quot;30s&quot;</span>

</code></pre></div><ul><li>启动</li></ul> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">nohup</span> ./venus-auth <span class="token operator">&gt;</span> auth.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><h3 id="注册生成各个组件的token"><a href="#注册生成各个组件的token" class="header-anchor">#</a> 注册生成各个组件的token</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ ./venus-auth genToken --perm admin miner
<span class="token operator">&lt;</span>auth token miner<span class="token operator">&gt;</span>

$ ./venus-auth genToken --perm admin messager
<span class="token operator">&lt;</span>auth token messager<span class="token operator">&gt;</span>

$ ./venus-auth genToken --perm admin sealer
<span class="token operator">&lt;</span>auth token sealer<span class="token operator">&gt;</span>
</code></pre></div><ul><li><code>&lt;auth token ?&gt;</code> 格式统一为 JWT token</li> <li>这些token之后会被各个程序使用，用以对集群接入组件做验证</li> <li><code>--perm</code>为RPC2.0接口访问权限限制</li> <li>miner，messager，sealer，推荐标记为程序名，若存在多个相同程序要加入集群，可以使用“程序名+标记符”。</li></ul> <h2 id="_2-venus-install"><a href="#_2-venus-install" class="header-anchor">#</a> 2. Venus install</h2> <h3 id="安装编译环境"><a href="#安装编译环境" class="header-anchor">#</a> 安装编译环境</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> yum <span class="token function">install</span> -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm<span class="token punctuation">;</span> <span class="token function">sudo</span> yum <span class="token function">install</span> -y <span class="token function">git</span> gcc bzr jq pkgconfig clang llvm mesa-libGL-devel opencl-headers ocl-icd ocl-icd-devel hwloc-devel
</code></pre></div><h3 id="编译并启动-2"><a href="#编译并启动-2" class="header-anchor">#</a> 编译并启动</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> clone https://github.com/filecoin-project/venus.git

$ <span class="token builtin class-name">cd</span> venus

$ <span class="token function">make</span> deps

$ <span class="token function">make</span>

<span class="token comment"># 启动venus daemon 设置网络与Venus-auth的地址</span>
<span class="token comment"># 启动成功后tail -f venus.log 可以看到数据同步的log</span>
<span class="token comment"># 这里需要等待一段时间</span>
$ <span class="token function">nohup</span> ./venus daemon --network nerpa <span class="token punctuation">\</span>
--authURL http://<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>:8989 <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> venus.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span> 
</code></pre></div><ul><li><code>--authURL</code> 为设置Venus-auth监听http地址</li></ul> <h3 id="修改ipv4监听地址"><a href="#修改ipv4监听地址" class="header-anchor">#</a> 修改IPV4监听地址</h3> <p>目前程序启动后默认监听地址为<code>127.0.0.1:3453</code>，对于跨服务器集群，需要修改监听策略，可以通过<code>lsof -i:3453</code> 查询到进程后，Kill掉进程，修改IPV4策略后重启</p> <div class="language-shell script extra-class"><pre class="language-shell"><code><span class="token function">vim</span> ~/.venus/config.json

<span class="token comment"># 做如下操作，修改为监听所有本机IPV4地址：</span>
<span class="token comment"># replace api.apiAddress from </span>
<span class="token comment"># &quot;/ip4/127.0.0.1/tcp/3453&quot;  to  &quot;/ip4/0.0.0.0/tcp/3453&quot;</span>

<span class="token comment"># 修改完毕后重启服务：</span>
$ <span class="token function">nohup</span> ./venus daemon --network nerpa <span class="token punctuation">\</span>
--authURL http://<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>:8989 <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> venus.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span> <span class="token operator">&lt;</span>absolute path<span class="token operator">&gt;</span>
</code></pre></div><h2 id="_3-venus-wallet-install"><a href="#_3-venus-wallet-install" class="header-anchor">#</a> 3. Venus-wallet install</h2> <h3 id="编译并启动-3"><a href="#编译并启动-3" class="header-anchor">#</a> 编译并启动</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> clone https://github.com/filecoin-project/venus-wallet.git

$ <span class="token builtin class-name">cd</span> venus-wallet 

<span class="token comment"># 编译</span>
$ <span class="token function">make</span>

<span class="token comment"># 启动</span>
$ <span class="token function">nohup</span> ./venus-wallet run  --network test<span class="token operator">&gt;</span> wallet.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><h3 id="设置密码并创建钱包"><a href="#设置密码并创建钱包" class="header-anchor">#</a> 设置密码并创建钱包</h3> <blockquote><p>此处创建了2个BLS钱包，用于之后的Venus-sealer初始化</p></blockquote> <div class="language-shell script extra-class"><pre class="language-shell"><code><span class="token comment"># 设置加解锁密码</span>
$ ./venus-wallet setpwd
Password:******
Enter Password again:******

<span class="token comment"># 生成BLS地址</span>
$ ./venus-wallet new bls
<span class="token operator">&lt;</span>bls address <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
$ ./venus-wallet new bls
<span class="token operator">&lt;</span>bls address <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>
</code></pre></div><ul><li><code>&lt;bls address 1&gt;</code> 为86位长度地址</li></ul> <h4 id="注意"><a href="#注意" class="header-anchor">#</a> 注意</h4> <p>新生成的<code>&lt;bls address 1&gt;</code> <code>&lt;bls address 2&gt;</code>需要到https://faucet.nerpa.interplanetary.dev/funds.html中预充balance后才能在链上生成actor。</p> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ ./venus-wallet auth api-info --perm admin
<span class="token operator">&lt;</span>wallet jwt token<span class="token operator">&gt;</span>
</code></pre></div><h2 id="_4-venus-messager-install"><a href="#_4-venus-messager-install" class="header-anchor">#</a> 4. Venus-messager install</h2> <h3 id="编译并启动-4"><a href="#编译并启动-4" class="header-anchor">#</a> 编译并启动</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> clone https://github.com/filecoin-project/venus-messager.git

$ <span class="token builtin class-name">cd</span> venus-messager

$ <span class="token function">make</span> deps

$ <span class="token function">make</span> 

<span class="token comment"># 启动venus-message 进程</span>
$ <span class="token function">nohup</span> ./venus-messager run <span class="token punctuation">\</span>
--auth-url<span class="token operator">=</span>http://<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>:8989 <span class="token punctuation">\</span>
--node-url /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>/tcp/3453 <span class="token punctuation">\</span>
--node-token <span class="token operator">&lt;</span>auth token messager<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--db-type mysql <span class="token punctuation">\</span>
--mysql-dsn <span class="token string">&quot;root:111111@tcp(127.0.0.1:3306)/cali_venus?parseTime=true&amp;loc=Local&amp;readTimeout=10s&amp;writeTimeout=10s&quot;</span> <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> msg.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>

</code></pre></div><ul><li><code>--auth-url</code> 为设置Venus-auth监听地址</li> <li><code>--node-url</code> 为Venus监听地址</li> <li><code>--node-token</code> 为使用Venus-auth中注册的JWT token代表自身节点，用于和Venus通信时的身份验证</li></ul> <h3 id="添加钱包链接-可以添加多个钱包链接"><a href="#添加钱包链接-可以添加多个钱包链接" class="header-anchor">#</a> 添加钱包链接（可以添加多个钱包链接）</h3> <blockquote><p>这边会周期性监控<code>Venus-wallet</code>的钱包可访问地址变化 <br>
做延时性动态跟踪，依赖于<code>Venus-wallet</code>处的<code>list</code>接口</p></blockquote> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ ./venus-messager wallet <span class="token function">add</span> <span class="token punctuation">\</span>
--name testminer --url /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/tcp/5678/http <span class="token punctuation">\</span>
--token <span class="token operator">&lt;</span>wallet jwt token<span class="token operator">&gt;</span> 

<span class="token comment"># 查询钱包列表</span>
$ ./venus-messager wallet list
</code></pre></div><ul><li><code>--name</code> 为给Venus-messager添加钱包链接命名</li> <li><code>--url</code> 为设置Venus-wallet监听地址</li> <li><code>--token</code> 为设置Venus-wallet中获得的接口授权JWT token,查看Venus-wallet install中<code>&lt;wallet jwt token&gt;</code>处可查看token如何获得</li></ul> <h2 id="_5-venus-sealer-install"><a href="#_5-venus-sealer-install" class="header-anchor">#</a> 5. Venus-sealer install</h2> <h3 id="sealer-存在2类jwt-token的概念"><a href="#sealer-存在2类jwt-token的概念" class="header-anchor">#</a> sealer 存在2类JWT token的概念</h3> <ol><li>本地JWT token <code>&lt;sealer jwt token&gt;</code> 用于其他服务访问sealer</li> <li>Venus-auth 注册的JWT token <code>&lt;auth token sealer&gt;</code>，用于sealer访问messager</li></ol> <h3 id="编译并启动-sealer单程序只能绑定一个矿工"><a href="#编译并启动-sealer单程序只能绑定一个矿工" class="header-anchor">#</a> 编译并启动（sealer单程序只能绑定一个矿工）</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> clone https://github.com/filecoin-project/venus-sealer.git

$ <span class="token builtin class-name">cd</span> venus-sealer

$ <span class="token function">make</span> deps

$ <span class="token function">make</span>

</code></pre></div><h4 id="初始化新矿工-2选1"><a href="#初始化新矿工-2选1" class="header-anchor">#</a> 初始化新矿工（2选1）</h4> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">nohup</span> ./venus-sealer init <span class="token punctuation">\</span>
--worker <span class="token operator">&lt;</span>bls address <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> <span class="token punctuation">\</span>
--owner <span class="token operator">&lt;</span>bls address <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>  <span class="token punctuation">\</span>
--sector-size 512M <span class="token punctuation">\</span>
--network nerpa <span class="token punctuation">\</span>
--node-url /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>/tcp/3453 <span class="token punctuation">\</span>
--node-token <span class="token operator">&lt;</span>auth token sealer<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--messager-url http://<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span>:39812/rpc/v0 <span class="token punctuation">\</span>
--no-local-storage <span class="token punctuation">\</span>
--messager-token <span class="token operator">&lt;</span>auth token sealer<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--wallet-name testminer <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> sealer.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>

</code></pre></div><h4 id="初始化已存在矿工-2选1"><a href="#初始化已存在矿工-2选1" class="header-anchor">#</a> 初始化已存在矿工（2选1）</h4> <blockquote><p>不需要指定<code>--sector-size</code></p></blockquote> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ ./venus-sealer init <span class="token punctuation">\</span>
--actor <span class="token operator">&lt;</span>t0 addr<span class="token operator">&gt;</span>  <span class="token punctuation">\</span>
--network nerpa <span class="token punctuation">\</span>
--node-url /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>/tcp/3453 <span class="token punctuation">\</span>
--node-token <span class="token operator">&lt;</span>auth token sealer<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--messager-url http://<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span>:39812/rpc/v0 <span class="token punctuation">\</span>
--no-local-storage <span class="token punctuation">\</span>
--messager-token <span class="token operator">&lt;</span>auth token sealer<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--wallet-name testminer 

<span class="token comment"># 查看日志等待消息上链注册actor地址</span>
<span class="token number">2021</span>-04-25T18:41:31.925+0800	INFO	main	venus-sealer/init.go:182	Checking <span class="token keyword">if</span> repo exists
<span class="token number">2021</span>-04-25T18:41:31.926+0800	INFO	main	venus-sealer/init.go:217	Checking full node version
<span class="token number">2021</span>-04-25T18:41:31.927+0800	INFO	main	venus-sealer/init.go:233	Initializing repo
<span class="token number">2021</span>-04-25T18:41:31.928+0800	INFO	main	venus-sealer/init.go:309	Initializing libp2p identity
<span class="token number">2021</span>-04-25T18:41:32.082+0800	INFO	main	venus-sealer/init.go:485	Pushed CreateMiner message: aaf489f9-af4b-4e4b-9084-018d43f05b7e
<span class="token number">2021</span>-04-25T18:41:32.082+0800	INFO	main	venus-sealer/init.go:486	Waiting <span class="token keyword">for</span> confirmation
<span class="token number">2021</span>-04-25T18:46:32.088+0800	INFO	main	venus-sealer/init.go:502	New miners address is: t01640 <span class="token punctuation">(</span>t2cxzf7xvrqo3froqn2xgdqjdbydhkcrgakj7j3ma<span class="token punctuation">)</span>
<span class="token number">2021</span>-04-25T18:46:32.088+0800	INFO	main	venus-sealer/init.go:381	Created new miner: t01640
<span class="token number">2021</span>-04-25T18:46:32.089+0800	INFO	main	venus-sealer/init.go:302	Sealer successfully created, you can now start it with <span class="token string">'venus-sealer run'</span>

</code></pre></div><ul><li><code>--wallet-name testminer</code> 为Venus-messager中add 的wallet 连接，所以在wallet中，这边指定的worker和owner必须在Venus-wallet中存在</li> <li><code>&lt;bls address 1&gt;</code> <code>&lt;bls address 2&gt;</code> 为Venus-wallet中创建的BLS钱包地址，注意这2个钱包地址都需要有balance</li> <li><code>&lt;auth token sealer&gt;</code>为Venus-auth中注册的JWT token</li> <li><code>&lt;absolute path&gt;</code>为绝对路径</li></ul> <h4 id="启动sealer并执行sector封装"><a href="#启动sealer并执行sector封装" class="header-anchor">#</a> 启动sealer并执行sector封装</h4> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">nohup</span> ./venus-sealer run <span class="token operator">&gt;&gt;</span> sealer.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>

<span class="token comment"># 指定存储目录(可选)</span>
<span class="token comment"># 因为指定了--no-local-storage</span>
<span class="token comment"># 所以需要指定sealer存储目录</span>
$ ./venus-sealer storage attach --init --store --seal <span class="token operator">&lt;</span>absolute path<span class="token operator">&gt;</span>

<span class="token comment"># 执行sector封装，这个命令只支持单次</span>
<span class="token comment"># 可以通过crontab 做定时任务，也可以自行编写策略脚本执行</span>
$ ./venus-sealer sectors pledge 

<span class="token comment"># 查看sector列表</span>
$ ./venus-sealer sectors list

<span class="token comment"># 查看actor地址</span>
<span class="token comment"># 这里为&lt;t0 addr&gt;</span>
$ ./venus-sealer info

Chain: <span class="token punctuation">[</span>sync ok<span class="token punctuation">]</span> <span class="token punctuation">[</span>basefee <span class="token number">100</span> aFIL<span class="token punctuation">]</span>
Sealer: <span class="token operator">&lt;</span>t0 addr<span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token number">512</span> MiB sectors<span class="token punctuation">)</span>
Power: <span class="token number">0</span>  / <span class="token number">15</span> Ti <span class="token punctuation">(</span><span class="token number">0.0000</span>%<span class="token punctuation">)</span>
	Raw: <span class="token number">0</span> B / <span class="token number">1.5</span> TiB <span class="token punctuation">(</span><span class="token number">0.0000</span>%<span class="token punctuation">)</span>
	Committed: <span class="token number">3</span> GiB
	Proving: <span class="token number">0</span> B
Below minimum power threshold, no blocks will be won
Sealer Balance:    <span class="token number">383.869</span> FIL
      PreCommit:  <span class="token number">0</span>
      Pledge:     <span class="token number">93.75</span> mFIL
      Vesting:    <span class="token number">0</span>
      Available:  <span class="token number">383.775</span> FIL
Market Balance:   <span class="token number">0</span>
       Locked:    <span class="token number">0</span>
       Available: <span class="token number">0</span>
Worker Balance:   <span class="token number">1000</span> FIL
Total Spendable:  <span class="token number">1383.775</span> FIL
</code></pre></div><h2 id="_6-venus-miner-install"><a href="#_6-venus-miner-install" class="header-anchor">#</a> 6. Venus-miner install</h2> <h3 id="编译并启动-5"><a href="#编译并启动-5" class="header-anchor">#</a> 编译并启动</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> clone https://github.com/filecoin-project/venus-miner.git

$ <span class="token builtin class-name">cd</span> venus-miner

$ <span class="token function">make</span> nerpanet

<span class="token comment"># 初始化环境配置</span>
$ ./venus-miner init --api /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>/tcp/3453 --token <span class="token operator">&lt;</span>auth token miner<span class="token operator">&gt;</span>

<span class="token comment"># 启动miner</span>
$ <span class="token function">nohup</span> ./venus-miner run <span class="token operator">&gt;&gt;</span>miner.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;&amp;</span> <span class="token number">1</span> <span class="token operator">&amp;</span>


$ ./venus-miner address <span class="token function">add</span> <span class="token punctuation">\</span>
--addr <span class="token operator">&lt;</span>t0 addr<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--sealer-listen-api /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span>/tcp/2345/http <span class="token punctuation">\</span>
--sealer-token <span class="token operator">&lt;</span>sealer jwt token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--wallet-listen-api /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/tcp/5678/http <span class="token punctuation">\</span>
--wallet-token <span class="token operator">&lt;</span>wallet jwt token<span class="token operator">&gt;</span> 

<span class="token comment"># print</span>
<span class="token function">add</span> miner:  <span class="token punctuation">{</span><span class="token operator">&lt;</span>t0 addr<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">..</span>.<span class="token punctuation">}</span><span class="token punctuation">}</span>


<span class="token comment"># 查询miner状态</span>
$ ./venus-miner address state 
<span class="token comment"># print</span>
<span class="token punctuation">[</span>
	<span class="token punctuation">{</span>
		<span class="token string">&quot;Addr&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&lt;t0 addr&gt;&quot;</span>,
		<span class="token string">&quot;IsMining&quot;</span><span class="token builtin class-name">:</span> true,
		<span class="token string">&quot;Err&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment"># 如果IsMining为false</span>
<span class="token comment"># 需要执行</span>
$ ./venus-miner address start <span class="token operator">&lt;</span>t0 addr<span class="token operator">&gt;</span>

<span class="token comment"># 因为miner支持多矿工</span>
<span class="token comment"># 可以通过以下指令查看所有关联矿工</span>
<span class="token comment"># 对于矿工的启停可以自行安排</span>
$ ./venus-miner address list
</code></pre></div><ul><li><code>&lt;t0 addr&gt;</code>在Venus-sealer install部分查看</li> <li><code>&lt;sealer jwt token&gt;</code>为Venus-sealer节点JWT token，切换到对应服务器后<code>cat ~/.venussealer/token</code>可获得</li> <li><code>&lt;wallet jwt token&gt;</code> 为设置Venus-wallet中获得的接口授权JWT token,查看Venus-wallet install中<code>&lt;wallet jwt token&gt;</code>处可查看token如何获得</li></ul> <h2 id="_7-问题相关"><a href="#_7-问题相关" class="header-anchor">#</a> 7. 问题相关</h2> <ol><li>go mod 出先如下问题</li></ol> <div class="language-shell script extra-class"><pre class="language-shell"><code>SECURITY ERROR
This download does NOT match an earlier download recorded <span class="token keyword">in</span> go.sum.
The bits may have been replaced on the origin server, or an attacker may
have intercepted the download attempt.


<span class="token comment"># 解决方案</span>
go clean -modcache
go mod tidy
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/filecoin-project/docs/edit/master/docs/zh/How-To-Deploy-MingPool.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2021/6/1 上午11:16:57</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/Overview.html" class="prev">
        概述
      </a></span> <span class="next"><a href="/zh/Venus-replace-lotus.html">
        Venus替换Lotus
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.f57c37a9.js" defer></script><script src="/assets/js/2.7ef722c3.js" defer></script><script src="/assets/js/12.cc8a9a44.js" defer></script>
  </body>
</html>
